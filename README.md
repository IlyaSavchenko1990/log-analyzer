<p align="center">
    <h1 align="center">Скрипт для автоматического анализа отказов из логов сервера</h1>
    <br>
</p>

На вход stdin подается файл логов и параметры анализа: 
- `-u` - минимально допустимый уровень доступности (проценты. Например, "99.9") (Обязательный); 
- `-t` - приемлемое время ответа (миллисекунды. Например, "45") (Опционально);
- `-s` - масштаб - количество запросов из которых вычисляется доля отказов (Опционально);

Отказом считается HTTP-ответ со статусом 5xx, а также время ответа в мс выше заданного значения. 
Если параметр `-t` не задан - учитывается только код ответа.

### Запуск

Установка всех зависимостей composer (В корневой директории проекта):
```
composer update
```
или через docker:
```
docker run --rm --interactive --tty --volume $PWD:/app composer update
или (На некоторых платформах)
docker run --rm -v $(pwd):/app composer update
```

Билд Docker-контейнера:
```
docker build -t analyzer .
```

Для запуска используется команда:

```
cat ./test.log | docker run --rm -i analyzer php index.php -t 34 -u 99.99 
```

Или через bash-скрипт:
```
cat test.log | sh analyze.sh -t 34 -u 99.99 -s 10
```

Вывод описания параметров:
```
sh analyze.sh --help
```

Для запуска тестов:

```
sh run-tests.sh
```

## Регулярные выражения

Регулярное выражение и дополнительные переменные для парсинга значений из строк логов задаются в переменных окружения в `Dockerfile`.
По-умолчанию регулярное выражение задано для строки вида:
```
0.0.0.0 - - [14/06/2017:17:01:42 +1000] "PUT / HTTP/1.1" 200 2 20.164372 "-" "@list-item-updater" prio:0
```

